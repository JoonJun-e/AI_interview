<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>카메라 On/Off</title>
    <style>
        body {
            display: flex;
            flex-direction: column; /* 요소들을 세로로 정렬 */
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #2c3e50; /* 배경색 변경 */
        }
        video {
            border: 5px solid #3498db;
            border-radius: 10px;
            transform: scaleX(-1); /* 거울 모드 */
            background-color: #000; /* 비디오 배경을 검은색으로 */
        }
        #controls {
            margin-top: 20px; /* 비디오와 버튼 사이 간격 */
        }
        button {
            font-size: 16px;
            padding: 10px 20px;
            margin: 0 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        #on-btn {
            background-color: #2ecc71; /* 초록색 */
            color: white;
        }
        #on-btn:hover {
            background-color: #27ae60;
        }
        #off-btn {
            background-color: #e74c3c; /* 빨간색 */
            color: white;
        }
        #off-btn:hover {
            background-color: #c0392b;
        }
    </style>
</head>
<body>

    <video id="webcam" width="640" height="480" autoplay playsinline></video>
    
    <div id="controls">
        <button id="on-btn">카메라 켜기</button>
        <button id="off-btn">카메라 끄기</button>
    </div>

    <script>
        // 1. HTML 요소들을 가져옵니다.
        const videoElement = document.getElementById('webcam');
        const onBtn = document.getElementById('on-btn');
        const offBtn = document.getElementById('off-btn');

        // 2. 카메라 스트림 상태를 저장할 변수를 만듭니다. (핵심)
        let localStream;

        // 3. 카메라를 켜는 함수
        async function startCamera() {
            // 이미 켜져 있다면 함수를 종료합니다.
            if (localStream) {
                console.log("카메라가 이미 켜져 있습니다.");
                return;
            }
            try {
                // 카메라 권한을 요청하고 스트림을 받아옵니다.
                const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                videoElement.srcObject = stream;
                localStream = stream; // 받아온 스트림을 변수에 저장
            } catch (err) {
                console.error("카메라 접근 실패:", err);
                alert("카메라 권한을 허용해주세요.");
            }
        }

        // 4. 카메라를 끄는 함수
        function stopCamera() {
            // 꺼져 있다면 함수를 종료합니다.
            if (!localStream) {
                console.log("카메라가 이미 꺼져 있습니다.");
                return;
            }
            // 스트림의 모든 트랙(비디오, 오디오)을 정지시켜 실제로 카메라를 끕니다.
            localStream.getTracks().forEach(track => {
                track.stop();
            });
            // 비디오 요소의 소스를 비웁니다.
            videoElement.srcObject = null;
            localStream = null; // 스트림 변수를 비웁니다.
        }

        // 5. 각 버튼에 클릭 이벤트를 연결합니다.
        onBtn.addEventListener('click', startCamera);
        offBtn.addEventListener('click', stopCamera);

    </script>

</body>
</html>